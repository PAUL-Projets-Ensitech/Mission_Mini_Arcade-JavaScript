<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="../../style.css">
    <link rel="icon" type="image/png" href="../../img/canardpixel.png">
    <title>ArcadeGames | Infinite Runner</title>
</head>

<body>
    <a href="../../index.html" class="btn-retour">⬅ Retour à l'accueil</a>
    <header>
        <h1>Jeux d'Arcades en JavaScript</h1>
        <h2>Jouez au jeu du Infinite Runner</h2>
    </header>

    <main class="game-page">
        <section class="game">
            <div class="game-area" id="game">
                <div class="player" id="player"></div>
                <div class="obstacle" id="obstacle"></div>
            </div>
            <div class="hud">
                <p id="score" class="score">Score : 0</p>
                <p class="hint">Appuie sur Espace ou clique pour sauter</p>
                <p id="status" class="status"></p>
                <button id="restart" class="btn-play" type="button">Jouer</button>
            </div>
        </section>
    </main>

    <footer>
        <small><i>&copy; MULLER Paul ● Projet Web : La Mini-Arcade JavaScript ● <a href="https://github.com/PAUL-Projets-Ensitech/Mission_Mini_Arcade-JavaScript">GitHub</a></i></small>
    </footer>

    <script>
        const player = document.getElementById('player');
        const obstacle = document.getElementById('obstacle');
        const scoreDisplay = document.getElementById('score');
        const statusDisplay = document.getElementById('status');
        const restartButton = document.getElementById('restart');
        const gameArea = document.getElementById('game');

        let isJumping = false;
        let gameOver = true;
        let score = 0;
        let collisionTimer = null;
        let scoreTimer = null;

        const jump = () => {
            if (isJumping || gameOver) {
                return;
            }
            isJumping = true;
            player.classList.add('jump');
            setTimeout(() => {
                player.classList.remove('jump');
                isJumping = false;
            }, 550);
        };

        const startGame = () => {
            gameOver = false;
            score = 0;
            statusDisplay.textContent = '';
            scoreDisplay.textContent = 'Score : 0';
            isJumping = false;
            player.classList.remove('jump');
            obstacle.classList.remove('moving');
            obstacle.style.animation = 'none';
            void obstacle.offsetHeight;
            obstacle.style.animation = '';
            obstacle.classList.add('moving');
            obstacle.style.animationPlayState = 'running';

            if (collisionTimer) {
                clearInterval(collisionTimer);
            }
            if (scoreTimer) {
                clearInterval(scoreTimer);
            }

            collisionTimer = setInterval(() => {
                const playerRect = player.getBoundingClientRect();
                const obstacleRect = obstacle.getBoundingClientRect();

                const playerHit = {
                    left: playerRect.left + 6,
                    right: playerRect.right - 6,
                    top: playerRect.top + 6,
                    bottom: playerRect.bottom - 2
                };

                const obstacleHit = {
                    left: obstacleRect.left + 4,
                    right: obstacleRect.right - 4,
                    top: obstacleRect.top + 4,
                    bottom: obstacleRect.bottom - 4
                };

                const collision = !(
                    playerHit.right < obstacleHit.left ||
                    playerHit.left > obstacleHit.right ||
                    playerHit.bottom < obstacleHit.top ||
                    playerHit.top > obstacleHit.bottom
                );

                if (collision) {
                    endGame();
                }
            }, 20);

            scoreTimer = setInterval(() => {
                if (!gameOver) {
                    score += 1;
                    scoreDisplay.textContent = `Score : ${score}`;
                }
            }, 200);
        };

        const endGame = () => {
            gameOver = true;
            obstacle.style.animationPlayState = 'paused';
            statusDisplay.textContent = 'Perdu ! Clique sur Rejouer.';
            clearInterval(collisionTimer);
            clearInterval(scoreTimer);
        };

        document.addEventListener('keydown', (event) => {
            if (event.code === 'Space') {
                event.preventDefault();
                jump();
            }
        });

        gameArea.addEventListener('click', jump);
        restartButton.addEventListener('click', startGame);

        statusDisplay.textContent = 'Clique sur Jouer pour commencer.';
    </script>
</body>

</html>